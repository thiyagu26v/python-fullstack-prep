<!DOCTYPE html>
<!-- ========================================== -->
<!-- Created by Thiyagarajan Varadharajan -->
<!-- LinkedIn: Share this resource! -->
<!-- ========================================== -->

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Django Master Level 2 - Vulcan Steel</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;600&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <style>
        :root {
            --bg: #0f172a;
            --card-bg: rgba(30, 41, 59, 0.7);
            --accent: #ff5722;
            --secondary: #64748b;
            --text: #f8fafc;
            --dim-text: #94a3b8;
            --border: rgba(255, 87, 34, 0.2);
            --glass: rgba(255, 255, 255, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Space+Grotesk', sans-serif;
            line-height: 1.6;
            padding: 40px 20px;
            background-image:
                linear-gradient(45deg, rgba(255, 87, 34, 0.05) 0%, transparent 70%),
                linear-gradient(135deg, rgba(15, 23, 42, 1) 0%, rgba(30, 41, 59, 1) 100%);
            background-attachment: fixed;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        h1 {
            font-size: 3.5rem;
            text-align: center;
            margin-bottom: 5px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: -2px;
            background: linear-gradient(to right, #ffffff, #ff5722);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            text-align: center;
            color: var(--dim-text);
            margin-bottom: 50px;
            font-weight: 300;
            letter-spacing: 2px;
        }

        .section-header {
            color: var(--accent);
            margin: 70px 0 30px;
            font-size: 2rem;
            font-weight: 600;
            border-left: 4px solid var(--accent);
            padding-left: 20px;
        }

        .question-card {
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.05);
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(20px);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .question-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: var(--accent);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .question-card:hover {
            background: rgba(30, 41, 59, 0.9);
            transform: translateX(10px);
        }

        .question-card:hover::before {
            transform: scaleY(1);
        }

        h3 {
            margin-bottom: 20px;
            color: #fff;
            font-size: 1.5rem;
            letter-spacing: -0.5px;
        }

        p {
            color: var(--dim-text);
            margin-bottom: 20px;
            font-weight: 400;
        }

        pre {
            background: #111 !important;
            padding: 25px !important;
            border-radius: 4px !important;
            margin: 20px 0 !important;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.05) !important;
        }

        .copy-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: var(--accent);
            padding: 6px 15px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .copy-btn:hover {
            background: var(--accent);
            color: #fff;
        }

        code {
            font-family: 'JetBrains Mono', monospace !important;
            font-size: 1rem !important;
        }

        hr {
            border: 0;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            margin: 50px 0;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: rgba(30, 41, 59, 0.5);
        }

        th,
        td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 87, 34, 0.1);
        }

        th {
            background: rgba(255, 87, 34, 0.1);
            color: var(--accent);
            font-weight: 600;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }

            body {
                padding: 20px 10px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>DRF & Advanced Django</h1>
        <p class="subtitle">System Architecture & Optimization • Vulcan Steel</p>

        <div id="target"></div>
    </div>

    <script type="text/markdown" id="raw-markdown">
## **Section 1: DRF Serializers (Q26-30)**

### **26. Create a basic ModelSerializer for a Product**
**Task:** Expose the `id`, `name`, and `price` of the `Product` model via DRF.

#### **Solution:**
```python
from rest_framework import serializers
from .models import Product

class ProductSerializer(serializers.ModelSerializer):
    class Meta:
        model = Product
        fields = ['id', 'name', 'price'] # Only expose specific fields
```

---

### **27. Add a custom calculated field using SerializerMethodField**
**Task:** Add a `taxed_price` field to the serializer that returns the price + 18% GST.

#### **Solution:**
```python
class ProductSerializer(serializers.ModelSerializer):
    taxed_price = serializers.SerializerMethodField() # Custom read-only field

    class Meta:
        model = Product
        fields = ['id', 'name', 'price', 'taxed_price']

    def get_taxed_price(self, obj): # Pattern: get_<fieldname>
        return obj.price * 1.18 # Add 18% tax to the original price
```

---

### **28. Implement Nested Serializers (Parent -> Child)**
**Task:** For a `Category` model, show all related `Product` items in the JSON response.

#### **Solution:**
```python
class CategorySerializer(serializers.ModelSerializer):
    products = ProductSerializer(many=True, read_only=True) # Many=True for lists

    class Meta:
        model = Category
        fields = ['id', 'name', 'products']
```

---

### **29. Validate data inside a Serializer**
**Task:** Ensure the `name` field in a `ProductSerializer` has at least 5 characters.

#### **Solution:**
```python
class ProductSerializer(serializers.ModelSerializer):
    class Meta:
        model = Product
        fields = '__all__'

    def validate_name(self, value): # Field-level validation
        if len(value) < 5:
            raise serializers.ValidationError("Name is too short!")
        return value
```

---

### **30. Override create() for custom logic in Serializer**
**Task:** When creating a `Comment`, automatically set the `ip_address` from the request.

#### **Solution:**
```python
class CommentSerializer(serializers.ModelSerializer):
    class Meta:
        model = Comment
        fields = ['body']

    def create(self, validated_data):
        # Accessing request from context passed by the view
        validated_data['ip_address'] = self.context['request'].META.get('REMOTE_ADDR')
        return super().create(validated_data)
```

---

## **Section 2: API Views & ViewSets (Q31-40)**

### **31. Create a function-based API view (@api_view)**
**Task:** Create a simple endpoint that returns {"message": "Hello"}.

#### **Solution:**
```python
from rest_framework.decorators import api_view
from rest_framework.response import Response

@api_view(['GET']) # Restricts to GET requests
def hello_api(request):
    return Response({"message": "Hello"}) # Returns JSON automatically
```

---

### **32. Use a Class-Based APIView**
**Task:** Implement a shared endpoint that handles GET (list) and POST (create).

#### **Solution:**
```python
from rest_framework.views import APIView
from rest_framework import status

class ProductAPI(APIView):
    def get(self, request):
        products = Product.objects.all()
        serializer = ProductSerializer(products, many=True)
        return Response(serializer.data)

    def post(self, request):
        serializer = ProductSerializer(data=request.data)
        if serializer.is_valid():
            serializer.save()
            return Response(serializer.data, status=status.HTTP_201_CREATED)
        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)
```

---

### **33. Faster development with Generic API Views**
**Task:** Create a list-and-create view using only 3 lines of code.

#### **Solution:**
```python
from rest_framework import generics

class ProductListCreate(generics.ListCreateAPIView):
    queryset = Product.objects.all()
    serializer_class = ProductSerializer
```

---

### **34. Full CRUD in one class (ModelViewSet)**
**Task:** Implement List, Create, Retrieve, Update, and Delete for `Order`.

#### **Solution:**
```python
from rest_framework import viewsets

class OrderViewSet(viewsets.ModelViewSet):
    queryset = Order.objects.all()
    serializer_class = OrderSerializer

# In urls.py: router.register(r'orders', OrderViewSet)
```

---

### **35. Add a custom @action to a ViewSet**
**Task:** Add a `cancel` endpoint (e.g., `/orders/1/cancel/`) to the Order ViewSet.

#### **Solution:**
```python
from rest_framework.decorators import action

class OrderViewSet(viewsets.ModelViewSet):
    # ... existing code ...

    @action(detail=True, methods=['post']) # detail=True means it needs an ID
    def cancel(self, request, pk=None):
        order = self.get_object()
        order.status = 'Cancelled'
        order.save()
        return Response({'status': 'order cancelled'})
```

---

### **36. Implement Token Authentication**
**Task:** Protect an API so only users with a valid token can access it.

#### **Solution:**
```python
from rest_framework.permissions import IsAuthenticated
from rest_framework.authentication import TokenAuthentication

class PrivateDataView(APIView):
    authentication_classes = [TokenAuthentication] # How to identify user
    permission_classes = [IsAuthenticated]     # What to check

    def get(self, request):
        return Response({"secret": "42"})
```

---

### **37. Custom Permission: IsOwnerOrReadOnly**
**Task:** Allow Anyone to see a post, but only the owner can edit/delete it.

#### **Solution:**
```python
from rest_framework import permissions

class IsOwnerOrReadOnly(permissions.BasePermission):
    def has_object_permission(self, request, view, obj):
        # Read permissions are allowed to any request (GET, HEAD, OPTIONS)
        if request.method in permissions.SAFE_METHODS:
            return True

        # Instance must have an attribute named `owner`.
        return obj.owner == request.user
```

---

## **Section 3: ORM Optimization (Q38-41)**

### **38. Fix the N+1 problem using select_related (ForeignKey)**
**Task:** Efficiently fetch all `Books` and their `Author` names in a single query.

#### **Solution:**
```python
# Problem: For N books, it makes 1 query for books + N queries for authors
# Solution: JOIN the tables in the database level
books = Book.objects.select_related('author').all()

for b in books:
    print(b.author.name) # No new query triggered here!
```

#### **Query Performance Board:**
| Approach | Number of DB Queries |
|---|---|
| Without `select_related` | 1 + N (where N is book count) |
| **With `select_related`** | **1 (Single SQL JOIN)** |

---

### **39. Fix the N+1 problem using prefetch_related (M2M)**
**Task:** Efficiently fetch all `Students` and all their related `Courses`.

#### **Solution:**
```python
# prefetch_related does 2 separate queries and joins them in Python
students = Student.objects.prefetch_related('courses').all()

for s in students:
    for c in s.courses.all(): # No new query triggered for courses
        print(c.title)
```

#### **Query Performance Board:**
| Approach | Number of DB Queries |
|---|---|
| Without `prefetch_related` | 1 + Number of Students |
| **With `prefetch_related`** | **2 (Total)** |

---

### **40. Use annotate() to count related objects**
**Task:** For each `Department`, calculate the total number of `Employees`.

#### **Solution:**
```python
from django.db.models import Count

# Logic: Adds a virtual field 'emp_count' to each department object
depts = Department.objects.annotate(emp_count=Count('employees'))

for d in depts:
    print(f"{d.name}: {d.emp_count}")
```

#### **Result Board:**
| Department | Employee Rows | Resulting `emp_count` |
|---|---|---|
| Engineering | 5 | **5** |
| Sales | 2 | **2** |

---

### **41. Use aggregate() for summary calculations**
**Task:** Find the average `price` of all `Products` in the store.

#### **Solution:**
```python
from django.db.models import Avg

# Logic: Returns a dictionary of summary data (not a queryset)
avg_data = Product.objects.aggregate(Avg('price'))
# Result: {'price__avg': 45.50}
```

#### **Logic Board:**
| Aggregation Type | Returns | Example Result |
|---|---|---|
| `annotate` | QuerySet (Extra fields per row) | `[Dept1(count=5), ...]` |
| **`aggregate`** | **Dictionary (Summary of whole table)** | `{'price__avg': 45.5}` |

---

## **Section 4: Performance & Advanced (Q42-50)**

### **42. Filtering APIs using DjangoFilterBackend**
**Task:** Allow users to filter the `Product` list by `category` and `min_price` via URL query params.

#### **Solution:**
```python
# settings.py: INSTALLED_APPS += ['django_filters']

from django_filters.rest_framework import DjangoFilterBackend

class ProductList(generics.ListAPIView):
    queryset = Product.objects.all()
    serializer_class = ProductSerializer
    filter_backends = [DjangoFilterBackend]
    filterset_fields = ['category', 'price'] # Enabled exact matching
```

---

### **43. Add Search and Ordering to an API**
**Task:** Allow searching by `title` and ordering by `created_at`.

#### **Solution:**
```python
from rest_framework.filters import SearchFilter, OrderingFilter

class PostList(generics.ListAPIView):
    queryset = Post.objects.all()
    serializer_class = PostSerializer
    filter_backends = [SearchFilter, OrderingFilter]
    search_fields = ['title', 'content'] # Partial matches allowed
    ordering_fields = ['created_at', 'author']
```

---

### **44. Implement API Throttling (Rate Limiting)**
**Task:** Limit users to 100 requests per day for a specific view.

#### **Solution:**
```python
from rest_framework.throttling import UserRateThrottle

class BurstRateThrottle(UserRateThrottle):
    scope = 'burst' # Defined in settings.py (e.g., '10/min')

class CriticalActionView(APIView):
    throttle_classes = [BurstRateThrottle]

    def post(self, request):
        return Response({"status": "action processed"})
```

---

### **45. View Caching for performance**
**Task:** Cache a heavy report view for 15 minutes.

#### **Solution:**
```python
from django.utils.decorators import method_decorator
from django.views.decorators.cache import cache_page
from django.views.generic import TemplateView

class HeavyReportView(TemplateView):
    template_name = "report.html"

    @method_decorator(cache_page(60 * 15)) # Cache for 15 mins (900 seconds)
    def dispatch(self, *args, **kwargs):
        return super().dispatch(*args, **kwargs)
```

---

### **46. DRF: Custom Validation outside of Serializer**
**Task:** Create a validator function and apply it to a Serializer field.

#### **Solution:**
```python
def validate_no_profanity(value): # Standalone logic
    if "badword" in value.lower():
        raise serializers.ValidationError("Language!")

class ReviewSerializer(serializers.Serializer):
    text = serializers.CharField(validators=[validate_no_profanity])
```

---

### **47. Handle Large Datasets with Pagination**
**Task:** Implement PageNumber pagination (10 per page) globally.

#### **Solution:**
```python
# settings.py
REST_FRAMEWORK = {
    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',
    'PAGE_SIZE': 10
}
```

---

### **48. Testing a DRF Endpoint (APITestCase)**
**Task:** Verify that creating a user returns a 201 status and JSON data.

#### **Solution:**
```python
from rest_framework.test import APITestCase
from django.urls import reverse

class AuthTests(APITestCase):
    def test_registration(self):
        url = reverse('register')
        data = {'username': 'testuser', 'password': 'password123'}
        response = self.client.post(url, data, format='json')
        self.assertEqual(response.status_code, 201)
```

---

### **49. Async View in Django (3.1+)**
**Task:** Create a view that calls an external API asynchronously.

#### **Solution:**
```python
import httpx
from django.http import JsonResponse

async def async_api_call(request):
    async with httpx.AsyncClient() as client:
        r = await client.get('https://api.example.com/data') # Non-blocking I/O
    return JsonResponse(r.json())
```

---

### **50. Use EXPLAIN to analyze a QuerySet**
**Task:** See the database execution plan for a slow query.

#### **Solution:**
```python
# In shell or view
print(Product.objects.filter(price__gt=1000).explain())

# Output: Shows Seq Scan vs Index Scan, Join type, and Cost.
```
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>

    <script>
        const target = document.getElementById('target');
        const rawMd = document.getElementById('raw-markdown').innerHTML;

        marked.setOptions({
            highlight: (code, lang) => {
                if (Prism.languages[lang]) {
                    return Prism.highlight(code, Prism.languages[lang], lang);
                }
                return code;
            },
            breaks: true,
            gfm: true
        });

        target.innerHTML = marked.parse(rawMd);

        function setupUI() {
            target.querySelectorAll('h2').forEach(h2 => h2.classList.add('section-header'));
            target.querySelectorAll('h3').forEach(h3 => {
                const card = document.createElement('div');
                card.className = 'question-card';
                let next = h3.nextElementSibling;
                card.appendChild(h3.cloneNode(true));
                h3.remove();
                while (next && next.tagName !== 'H3' && next.tagName !== 'H2' && next.tagName !== 'HR') {
                    let toMove = next;
                    next = next.nextElementSibling;
                    card.appendChild(toMove);
                }
                target.insertBefore(card, next);
            });
            target.querySelectorAll('pre').forEach(pre => {
                const btn = document.createElement('button');
                btn.className = 'copy-btn';
                btn.innerText = 'Copy';
                btn.onclick = () => {
                    const code = pre.querySelector('code').innerText;
                    navigator.clipboard.writeText(code).then(() => {
                        btn.innerText = 'Copied!';
                        setTimeout(() => btn.innerText = 'Copy', 2000);
                    });
                };
                pre.appendChild(btn);
            });
        }
        setupUI();
    </script>

<footer style="text-align: center; padding: 30px 20px; margin-top: 50px; border-top: 2px solid #30363d; background: linear-gradient(135deg, #161b22 0%, #0d1117 100%);">
    <p style="font-size: 1.2rem; color: #00ffa3; margin-bottom: 10px;">✨ Created by <strong>Thiyagarajan Varadharajan</strong> ✨</p>
    <p style="font-size: 0.9rem; color: #8b949e;">Python Full Stack Developer | Interview Prep Resources</p>
</footer>
</body>


</html>